{% from "rbds/components/show-more.html" import show_more %}
{% from "rbds/components/editable-text.html" import editable_text %}
{% from "rbds/components/modal.html" import modal %}
{% from "macros/icon.html" import rbds_icon %}
<section id="your-documents" class ="rbds-card rbds-card--no-border" {% if oob %}hx-swap-oob="outerHTML"{% endif %}>
    <div class="rbds-card__header">
        {{ rbds_icon(icon_name="file-present.svg") }}
        <h3 class="side-panel-heading__text">Documents</h3>
    </div>
    <div class="rbds-card__content">
        <document-selector id="document-selector" class="rbds-full-width">
            <fieldset class="govuk-fieldset">
                <div class="rbds-card__list govuk-checkboxes govuk-checkboxes--small rbds-checkbox rbds-checkbox--side-panel"
                    data-module="govuk-checkboxes">
                    {% for file in completed_files %}
                    <div class="rbds-list-row govuk-!-display-none">
                        {% set document_edit_url = url('document-titles', doc_id=file.id) %}
                        {% call editable_text(document_edit_url, 'document-title-change', 'your-documents', file.id) %}
                            <div class="govuk-checkboxes__item item-checkbox-container display">
                                <input class="govuk-checkboxes__input rbds-item-checkbox__input" id="file-{{ file.id }}" name="file-{{ file.id }}" type="checkbox"
                                    value="{{ file.id }}" title="{{ file.file_name }}" {% if file.selected %}checked{% endif %}>
                                <label class="item-checkbox-label rbds-item-label rbds-item-link govuk-checkboxes__label title-text" for="file-{{ file.id }}"
                                    title="{{ file.file_name }}">
                                    {{ file.file_name }}
                                    {% if request.user.is_superuser and file.team_associations.exists() and file.team_associations.first.visibility == 'TEAM' %}
                                        (Shared with {{ file.team_associations.first().team.team_name }})
                                    {% endif %}
                                </label>
                            </div>
                            <div class="govuk-!-display-none edit-input-wrapper">
                                <label class="govuk-visually-hidden" for="item-title-text-input-{{ file.id }}">Document name</label>
                                <input class="edit-input" type="text" id="item-title-text-input-{{ file.id }}" />
                            </div>
                            <div class="rbds-item-actions">
                                <button class="rbds-icon-button edit-trigger" type="button" data-action="rename">
                                    {{ rbds_icon(icon_name="edit.html", icon_classes="link") }}
                                    <span class="govuk-visually-hidden"> edit document: {{ file.file_name }}</span>
                                </button>
                                {% call modal() %}
                                    <button class="rbds-icon-button modal-open">{{ rbds_icon(icon_name="delete.html", icon_classes="link") }}</button>
                                    <dialog>
                                        <div>
                                            <h2 class="govuk-heading-m">Are you sure you want to delete this file?</h2>
                                            <span class="govuk-captionx-xs">This action will remove <span class="govuk-!-font-weight-bold rbds-text-emphasis">{{ file.file_name }}</span> from Redbox and cannot be reversed.</span>
                                        </div>
                                        <div>
                                            <button class="govuk-button govuk-!-margin-right-4 govuk-!-margin-bottom-0 govuk-!-margin-top-4 govuk-button--warning modal-close"
                                                    hx-post="/documents/{{ file.id }}/delete-document/"
                                                    hx-vals='{
                                                        "active_chat_id": "{{ chat_id }}",
                                                        "file_selected": "{{ file.selected }}"
                                                    }'
                                                    hx-target="closest .rbds-list-row"
                                                    hx-swap="delete">
                                                Yes delete
                                                <span class="govuk-visually-hidden"> delete document: {{ file.file_name }}</span>
                                            </button>
                                            <button class="govuk-button govuk-!-margin-right-4 govuk-!-margin-bottom-0 govuk-!-margin-top-4 govuk-button--secondary modal-close" data-module="govuk-button">
                                                No cancel
                                            </button>
                                        </div>
                                    </dialog>
                                {% endcall %}
                            </div>
                        {% endcall %}
                    </div>
                    {% endfor %}
                    {# files not yet ready - stored here to be moved to main list once ready #}
                    <div hidden>
                        {% for file in processing_files %}
                        <div class="govuk-checkboxes__item">
                            <input class="govuk-checkboxes__input" id="file-{{ file.id }}" name="file-{{ file.id }}"
                                type="checkbox" value="{{ file.id }}" {% if file.selected %}checked{% endif %}>
                            <label class="item-checkbox-label rbds-item-label govuk-checkboxes__label" for="file-{{ file.id }}">
                                {{ file.file_name }}
                                {% if request.user.is_superuser and file.team_associations.exists() %}
                                    (Shared with {{ file.team_associations.first().team.team_name }})
                                {% endif %}
                            </label>
                            <file-status data-id="{{ file.id }}"></file-status>
                        </div>
                        {% endfor %}
                    </div>
                    {{ show_more('#your-documents', '.rbds-list-row', 3) }}
                </div>
            </fieldset>
        </document-selector>
    </div>
</section>
