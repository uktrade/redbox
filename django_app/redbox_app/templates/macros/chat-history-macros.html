{% from "components/editable-text.html" import editable_text %}
{% from "components/modal.html" import modal %}

{% macro chat_history_heading(text) %}
    <h3 class="govuk-body govuk-!-font-weight-bold govuk-!-margin-bottom-1 side-panel-subheading {% if text|lower == 'previous' or text|lower == 'today' %}no-border{% endif %}">{{ text }}</h3>
    {{ caller() }}
{% endmacro %}


{% macro chat_history_item (chat, link, active_chat_id) %}
    <li class="side-panel-item-container" id="chat-{{ chat.id }}">
        {% set chat_edit_url = url('chat-titles', chat.id) %}
        {% call editable_text(chat_edit_url, 'chat-title-change', 'recent-chats', chat.id) %}
            <div class="chat-list-item {% if chat.id == active_chat_id %}selected{% endif %}" data-chatid="{{ chat.id }}">
                <span class="item-text-container">
                    <a class="item-link govuk-link govuk-link--no-visited-state govuk-link--no-underline display title-text"
                    href="{{ link }}" {% if chat.id == active_chat_id %}aria-current="page"{% endif %} title="{{ chat.name }}">
                        {{ chat.name }}
                    </a>
                    <div class="item-text-input govuk-!-display-none edit-input-wrapper">
                        <label class="govuk-visually-hidden" for="chat-title-text-input-{{ chat.id }}">Chat title</label>
                        <input class="chat-title-text-input edit-input" type="text" id="chat-title-text-input-{{ chat.id }}"/>
                    </div>
                </span>
                <div class="side-panel-item-actions">
                    <button class="edit-button edit-trigger" type="button" data-action="rename">
                        {% include 'icons/edit.html' %}
                        <span class="govuk-visually-hidden"> edit chat: {{ chat.name }}</span>
                    </button>
                    {% call modal() %}
                        <button class="delete-button modal-open">{% include 'icons/delete.html' %}</button>
                        <dialog>
                            <div>
                                <h2 class="govuk-heading-m">Are you sure you want to delete this chat?</h2>
                                <span class="govuk-captionx-xs">This action will remove <span id="delete-chat-confirm-title" class="govuk-!-font-weight-bold text-emphasis">{{ chat.name }}</span> from Redbox and cannot be reversed.</span>
                            </div>
                            <div>
                                <button class="govuk-buttonx govuk-!-margin-right-4 govuk-!-margin-bottom-0 govuk-!-margin-top-4 govuk-button--warningx modal-close"
                                        id="delete-chat-confirm-button"
                                        hx-post="/chats/{{ chat.id }}/delete-chat/"
                                        hx-vals='{"active_chat_id": "{{ active_chat_id }}"}'
                                        hx-headers='{"X-CSRFToken": "{{ csrf_token }}"}'
                                        hx-target="#chat-{{ chat.id }}"
                                        hx-swap="delete">
                                    Yes delete
                                    <span class="govuk-visually-hidden">Yes, delete chat: {{ chat.name }}</span>

                                </button>
                                <button class="govuk-buttonx govuk-!-margin-right-4 govuk-!-margin-bottom-0 govuk-!-margin-top-4 govuk-button--secondaryx modal-close" data-module="govuk-button">
                                    No cancel
                                    <span class="govuk-visually-hidden">No, cancel delete chat: {{ chat.name }}</span>
                                </button>
                            </div>
                        </dialog>
                    {% endcall %}
                </div>
            </div>
        {% endcall %}
    </li>
{% endmacro %}
